$(function(){var s=20,a=1,i=window.location.href,e=urlParse(i);if(e.id=wendaID,$(".js-issue-box").size()>0){var t=!1;if($(".js-topic-desc").height()>2*parseInt($("body").css("fontSize"))){var o='<div class="more-desc-btn"><a href="javascript:void(0);" class="js-more-desc">查看更多</a></div>';$(".js-topic-desc").addClass("ellipsis2"),$(".js-issue-box").append(o)}$(".js-issue-box").on("click",".js-more-desc",function(){t?(t=!1,$(".js-topic-desc").addClass("ellipsis2"),$(this).text("查看全部")):(t=!0,$(".js-topic-desc").removeClass("ellipsis2"),$(this).text("收起全部"))})}if($(".js-load-more").size()>0&&$(".js-load-more").on("click",function(){a++,$.ajax({url:"/wap/api/wenda/issuedetailmore?id="+e.id+"&page="+a,type:"get",dataType:"json",success:function(a){for(var i="",e=0;e<a.data.length;e++){var t="",o="",d="";a.data[e].labels&&(t='<p class="from">来自 '+a.data[e].labels+"<span>"+a.data[e].answers+"个回答</span></p>"),a.data[e].top_reply?(o=1==a.data[e].top_reply.best_answer?'<p class="label">已采纳回答</p>':'<p class="label">最赞的回答</p>',o+='<div class="answer">'+a.data[e].top_reply.description+"</div>"):(d=a.data[e].followed?'<a href="javascript:void(0);" class="followed"><i class="imwap-star-choose"></i>已关注</a>':'<a href="javascript:void(0);"><i class="imwap-star-choose"></i>关注</a>',o='<div class="action clearfix"><a href="javascript:void(0);"><i class=""></i>我要回答</a>'+d+"</div>"),i+='<dd>								<img src="'+a.data[e].label_pic+'">								'+t+'								<p class="title">'+a.data[e].title+"</p>								"+o+"							</dd>"}a.data.length<s&&$(".js-load-more").remove(),$(".js-issue-list").append(i)}})}),$(".js-more-answer").size()>0&&(prettyPrint(),$(".js-more-answer").on("click",function(){a++,$.ajax({url:"/wap/api/wenda/wendadetailmore?id="+e.id+"&page="+a,type:"get",dataType:"json",success:function(a){for(var i="",e=0;e<a.data.length;e++){var t="/account/login";isLogin&&(t="http://www.imooc.com/m/web/wenda/replyList.html?bbsid="+a.data[e].bbs_id+"&&replyid="+a.data[e].id);var o="",d="";0==a.data[e].op?o="active":1==a.data[e].op&&(d="active"),i+='<dd><img src="'+a.data[e].userinfo.pic+'" class="avator"><p class="name">'+a.data[e].userinfo.nickname+'</p><div class="content">'+a.data[e].description+'</div><div class="action clearfix"><div class="l"><a href="javascript:void(0);" data-flag="support" class="like js-is-support js-support '+o+'"><i class="imwap-thumb_up"></i><span class="js-support-num">'+a.data[e].support_num+'</span></a><a href="javascript:void(0);" data-flag="unsupport" class="like js-is-support js-unsupport '+d+'"><i class="imwap-thumb_down"></i><span class="js-support-num">'+a.data[e].unsupport_num+'</span></a></div><div class="r"><a href="'+t+'">'+a.data[e].reply_num+'<i class="imwap-comment"></i></a></div></div></dd>'}a.data.length<s&&$(".js-more-answer").remove(),$(".js-answer-list").append(i)}})})),$(".js-favorite").size()>0){var d={},n=!1;$(".js-favorite").on("click",function(){var s=$(this);return isLogin||(window.location.href="/account/login"),n?!1:(d.id=$(".js-issue-list").size()>0?s.attr("data-id"):e.id,n=!0,d.type=s.hasClass("active")?"del":"add",void $.ajax({url:"/wap/api/wenda/favorite",type:"get",data:d,dataType:"json",success:function(a){1e3==a.data.errorCode&&("del"==d.type?($.msg("success","已取消关注"),s.removeClass("active"),$(".js-issue-list").size()>0&&s.find(".js-favorite-stat").html("关注")):($.msg("success","关注成功~"),s.addClass("active"),$(".js-issue-list").size()>0&&s.find(".js-favorite-stat").html("已关注")),n=!1)}}))})}$(".js-answer-list").size()>0&&$(".js-answer-list").on("click",".js-is-support",function(){isLogin||(window.location.href="/account/login");var s=$(this),a={replyid:s.closest("dd").attr("id"),id:e.id};a.op="support"==s.attr("data-flag")?s.hasClass("active")?-1:0:s.hasClass("active")?-2:1,$.ajax({url:"/wap/api/wenda/support",type:"get",data:a,dataType:"json",success:function(a){var i=0,e=0;1e3==a.data.errorCode&&(s.hasClass("active")?(s.removeClass("active"),i=parseInt(s.find(".js-support-num").text())-1):(s.addClass("active"),i=parseInt(s.find(".js-support-num").text())+1),s.siblings(".js-is-support").hasClass("active")&&(s.siblings(".js-is-support").removeClass("active"),e=parseInt(s.siblings(".js-is-support").find(".js-support-num").text())-1,s.siblings(".js-is-support").find(".js-support-num").text(e)),s.find(".js-support-num").html(i))}})}),$(".js-wenda-more").on("click",function(){$("#wenda_content").css("height","auto"),$("#wenda_content").removeClass("overflow"),$(".js-wenda-more").hide()});var r=function(){var s=window.screen.width,a=window.screen.height,i=$("body").width(),e=$("#wenda_content").height(),t=a*(i/s)*1.5;e>t&&($("#wenda_content").css("height",t),$("#wenda_content").addClass("overflow"),$(".js-wenda-more").show())},c=function(){r()};c()});